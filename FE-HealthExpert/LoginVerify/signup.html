<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Form</title>
</head>

<body>
    <h1>Register Form</h1>
    <form id="registerForm">
        <label for="userName">Username:</label>
        <input type="text" id="userName" name="userName" required><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>

        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" name="confirmPassword" required><br>

        <label for="fullname">Full Name:</label>
        <input type="text" id="fullname" name="fullname" required><br>

        <label for="phone">Phone:</label>
        <input type="text" id="phone" name="phone" required><br>

        <label for="gender">Gender:</label>
        <select id="gender" name="gender">
            <option value="true">Male</option>
            <option value="false">Female</option>
        </select><br>

        <label for="birthdate">Birthdate:</label>
        <input type="date" id="birthdate" name="birthdate" required><br>

        <button type="button" onclick="register()">Register</button>
        <button type="button" onclick="login()">Login</button>
    </form>

    <script>
        async function register() {
            const userName = document.getElementById('userName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const fullname = document.getElementById('fullname').value;
            const phone = document.getElementById('phone').value;
            const gender = document.getElementById('gender').value === 'true';
            const birthdate = document.getElementById('birthdate').value;

            // Validate password and confirm password match
            if (password !== confirmPassword) {
                alert("Password and Confirm Password do not match");
                return;
            }

            const registerData = {
                userName: userName,
                email: email,
                password: password,
                confirmPassword: confirmPassword,
                fullname: fullname,
                phone: phone,
                gender: gender,
                birthdate: birthdate
                // Add other properties as needed
            };

            try {
                const response = await fetch('https://localhost:7158/api/Account', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(registerData),
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log(result); // handle success response
                    location.replace("login.html");
                } else {
                    const error = await response.text();
                    console.error(error); // handle error response
                }
            } catch (error) {
                console.error('Error during registration:', error);

                // Check if the response is JSON before attempting to parse it
                if (error.response && error.response.headers.get('content-type')?.includes('application/json')) {
                    try {
                        const jsonResponse = await error.response.json();
                        console.log('JSON Response:', jsonResponse);

                        // Access the error message from the JSON object
                        const errorMessage = jsonResponse.error;
                        console.log('Error message:', errorMessage);

                        // Perform error message handling here
                    } catch (jsonError) {
                        console.error('Error parsing JSON response:', jsonError);
                    }
                } else {
                    console.log('Non-JSON Response:', await error.response.text());
                }
            }

        }
        async function login() {
            location.replace("login.html");
        }
    </script>
</body>

</html>